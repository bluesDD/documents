---
Title: 【リリース予告】ホスト情報の更新 API の仕様変更予定のお知らせ
Date: 2019-01-23T16:16:52+09:00
URL: https://mackerel.io/ja/blog/entry/announcement/20190123
EditURL: https://blog.hatena.ne.jp/mackerelio/mackerelio-ja.hatenablog.mackerel.io/atom/entry/98012380830991597
---

いつも Mackerel をご利用いただきありがとうございます。

2019年1月30日 (水) のリリースにおいて、[チェック監視結果の投稿 API](https://mackerel.io/ja/api-docs/entry/check-monitoring#post)のさらなる利便性のため、[ホスト情報の更新 API](https://mackerel.io/ja/api-docs/entry/hosts#update-information) の仕様を変更を予定しているため、事前にお知らせさせていただきます。

変更内容は以下の通りです。

### 変更前の仕様
[ホスト情報の更新 API](https://mackerel.io/ja/api-docs/entry/hosts#update-information) では、ホスト自身の情報の他に、そのホストを監視するチェック監視項目のリストを送信することができ、このリストと Mackerel 上のチェック監視項目が同期されます。

現在の仕様では、このリストに含まれていないチェック監視の結果がホストに対して投稿されていた場合は、ホスト情報の更新と同時に、それらのチェック監視の結果は Mackerel 上から削除され、またアラートが発生中の場合は自動的に閉じられます。

エージェントは内部的にホスト情報の更新 API を使用してホストの情報を定期的に更新しており、エージェントの設定ファイルに記述されたチェック監視項目のリストを合わせて送信しています。
この仕組みによって、設定ファイルと Mackerel 上のチェック監視項目の同期を行っており、設定ファイルを更新した際に削除されたチェック監視項目は、Mackerel 上からも削除しています。

### 変更後の仕様
ホスト情報の更新 API によって、送信されたチェック監視項目のリストとの同期を行う際の仕様が、以下のように変更されます:

リストに含まれないチェック監視の結果がホストに対して投稿されていた場合、

- そのチェック監視によるアラートが発生中の場合、チェック監視の結果は Mackerel 上から削除されず、またアラートも発生中のままとなります。
- そのチェック監視によるアラートが発生していない場合は、現在の仕様と同様、チェック監視の結果は Mackerel 上から削除されます。

### 仕様変更の意図
前述の通り、エージェントは内部的にホスト情報の更新 API を使用して、エージェントの設定ファイルに記述されたチェック監視項目を定期的に Mackerel と同期しています。
このため現在の仕様では、エージェント以外から[チェック監視結果の投稿 API](https://mackerel.io/ja/api-docs/entry/check-monitoring#post) を用いてチェック監視の結果をホストに投稿し、かつエージェントの設定ファイルにそのチェック監視項目が含まれていない場合は、アラートの有無にかかわらず定期的に削除が行われてしまうため、Mackerel 上でのチェック監視結果の表示やアラート機能を正常にご利用いただくことができませんでした。

変更後の仕様では、エージェント以外からチェック監視の結果を投稿し、エージェントの設定ファイルにそのチェック監視項目が含まれていない場合であっても、アラートが発生している場合は Mackerel 上からの削除が行われなくなるため、アラート機能を正常にご利用いただくことができるようになります。

注意点として、発生中のアラートがない場合は、現在と同様に、チェック監視の結果は Mackerel 上から削除されます。
このため、エージェントによるホスト情報の更新と、エージェント以外からチェック監視の結果の投稿のタイミングによっては、ホスト詳細画面上でのチェック監視結果の表示に差異が出る場合があります。
この点についてはご理解いただいた上でご利用ください。

今後とも Mackerel をよろしくお願いします。
